<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Tasks</title>
</head>
<body>
    <h1>Edit Tasks</h1>
    <form id="taskForm">
        <div id="tasksContainer"></div>
        <button type="submit">Save</button>
    </form>

    <script>
        // Функция для извлечения параметров из URL
        function getQueryParams() {
            const params = {};
            window.location.search.substring(1).split('&').forEach(param => {
                const [key, value] = param.split('=');
                params[key] = decodeURIComponent(value);
            });
            return params;
        }

        // Функция для создания полей ввода для каждого задания
        function createTaskFields(taskId, taskData) {
            const container = document.createElement('div');
            container.innerHTML = `<h2>Task: ${taskId}</h2>`;

            for (const [key, value] of Object.entries(taskData)) {
                const label = document.createElement('label');
                label.innerText = key.replace('_', ' ') + ': ';
                const input = document.createElement('input');
                input.type = 'text';
                input.name = `${taskId}_${key}`;
                input.value = value;
                container.appendChild(label);
                container.appendChild(input);
                container.appendChild(document.createElement('br'));
            }

            return container;
        }

        // Функция для инициализации формы
        function initForm() {
            const params = getQueryParams();
            const tasksContainer = document.getElementById('tasksContainer');

            for (const [key, value] of Object.entries(params)) {
                if (key.startsWith('task_id')) {
                    const taskId = value.split('|')[0].split('=')[1];
                    const taskData = {};
                    value.split('|').forEach(param => {
                        const [k, v] = param.split('=');
                        taskData[k] = v;
                    });
                    tasksContainer.appendChild(createTaskFields(taskId, taskData));
                }
            }
        }

        // Обработчик отправки формы
        document.getElementById('taskForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = {};

            formData.forEach((value, key) => {
                const [taskId, field] = key.split('_');
                if (!data[taskId]) {
                    data[taskId] = {};
                }
                data[taskId][field] = value;
            });

            // Отправляем данные обратно в Telegram бот
            Telegram.WebApp.sendData(JSON.stringify(data));
        });

        // Инициализация формы при загрузке страницы
        initForm();
    </script>
</body>
</html>
